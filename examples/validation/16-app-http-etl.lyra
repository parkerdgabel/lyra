(*
  16-app-http-etl.lyra â€” Mini ETL: fetch JSON via HTTP, transform, write CSV
  Requires network. Writes output under target/tmp.
*)

tmp := "target/tmp/etl"; MakeDirectory[tmp, <|"Parents"->True|>];
url := "https://httpbin.org/json";

resp := HttpGet[url];
data := Part[resp, "json"];  (* httpbin returns JSON; no branch needed *)

(* Project some fields if present; defensive Map *)
slides := Lookup[Lookup[data, "slideshow"], "slides"];
rows := Map[(<|"title"->Lookup[#, "title"], "type"->Lookup[#, "type"]|>)&, slides];
csv := RenderCSV[rows];
out := PathJoin[{tmp, "slides.csv"}]; WriteCSV[out, rows];
out;
