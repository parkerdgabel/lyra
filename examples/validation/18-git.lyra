(*
  18-git.lyra â€” Git stdlib API quick validation
  Run: lyra-runner --file examples/validation/18-git.lyra
*)

tmp := "target/tmp/git-demo";
MakeDirectory[tmp, <|"parents"->True|>];

(* create a file *)
WriteBytes[tmp<>"/README.md", "Hello git\n"];

(* init repo, add, commit *)
GitInit[<|"path"->tmp, "initialBranch"->"main"|>];
GitStatus[<|"cwd"->tmp|>];
GitAdd["README.md", <|"cwd"->tmp|>];
GitCommit["init", <|"cwd"->tmp|>];

GitCurrentBranch[<|"cwd"->tmp|>];
GitBranchList[<|"cwd"->tmp|>];
GitLog[<|"cwd"->tmp, "limit"->3|>];

(* update file and show diff *)
WriteBytes[tmp<>"/README.md", "Hello git, updated!\n"];
GitDiff[<|"cwd"->tmp, "base"->"HEAD", "paths"->{"README.md"}|>];
GitAdd[{"README.md"}, <|"cwd"->tmp|>];
GitCommit["update", <|"cwd"->tmp|>];

GitStatus[<|"cwd"->tmp|>];
